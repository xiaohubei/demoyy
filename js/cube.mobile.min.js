function isArraylike(a){var b="length"in a&&a.length,c=cb.util.type(a);return"function"===c||cb.util.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var cb={};cb.events={},cb.events.on=function(a,b,c){if(a&&b){this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);d.push({callback:b,context:c})}},cb.events.un=function(a,b){if(a&&this._events&&this._events[a])if(b){var c=this._events[a].findIndex(function(a){return a.callback===b?!0:void 0});-1!==c&&this._events[a].removeData(this._events[a][c])}else delete this._events[a]},cb.events.hasEvent=function(a){return a?this._events&&this._events[a]&&this._events[a].length:void 0},cb.events.execute=function(a){if(a){var b=this._events?this._events[a]:null;if(!b)return!0;var c=!0,d=Array.prototype.slice.call(arguments,1);return b.forEach(function(a){c=a.callback.apply(a.context||this,d)===!1?!1:c},this),c}},cb.widgets={},cb.widgets.register=function(a,b){return cb.widgets[a]?void console.error("widgetType "+a+"已注册"):void(cb.widgets[a]=b(a))},cb.widgets.register("BaseWidget",function(a){var b=function(a,b){var c={id:a,elem:Dom7("#"+a),options:b};this._get_data=function(a){return c[a]},this._set_data=function(a,b){c[a]=b}};return b.prototype.widgetType=a,b.prototype.getId=function(){return this._get_data("id")},b.prototype.getElement=function(){return this._get_data("elem")},b.prototype.getConfig=function(){return this._get_data("options")},b.prototype.getParent=function(){return this._get_data("parent")},b.prototype.getLazyLoadThreshold=function(){return 0},b.prototype.getProxyData=function(){return this.getConfig()},b.prototype.getTemplate=function(){return this.getElement().find("script").html()},b.prototype.render=function(a,b){var c=this.getTemplate(),d="string"==typeof c?c:c.html();b===!1&&template.config("escape",!1);var e=Template7.compile(d);return b===!1&&template.config("escape",!0),e(a)},b.prototype.rebuild=function(a){if(a&&this._set_data("options",a),!this.getProxy)return void(this.runTemplate&&this.runTemplate());var b=this.getProxy();if(b){var c=this.getProxyData(),d=null;this.runTemplate&&(d=this.runTemplate);var e=cb.rest.DynamicProxy.create({AutoRun:b});e.AutoRun(c,d,this)}},b}),cb.views={},cb.views.register=function(a,b){cb.views[a]=b(a)},cb.views.register("BaseView",function(a){var b=function(a){var b={widgets:a};this._get_data=function(a){return b[a]},this._set_data=function(a,c){b[a]=c}};return b.prototype.controllerName=a,b.prototype.getView=function(){return this._get_data("view")},b.prototype.getWidgets=function(){return this._get_data("widgets")},b.prototype.getWidget=function(a){return this.getWidgets()[a]},b.prototype.getViewData=function(){return this._get_data("viewData")},b.prototype.getQuery=function(){return this._get_data("query")},b.prototype.run=function(a){var b,c,d=this.getWidgets(),e=this.getProxyData,f=cb.rest.MergeProxy.create();for(var g in d)if(b=d[g],c=b.getElement(),!c.hasClass("widgetHasLoaded")&&(cb.rest.AppContext.preview||a||cb.util.isElementInViewport(c[0],b.getLazyLoadThreshold())))if(c.addClass("widgetHasLoaded"),b.getProxy){var h=b.getProxy();if(h){var i=b.getProxyData();if(e){var j=e.call(this,g);j&&(i=j)}var k=null;b.runTemplate&&(k=b.runTemplate),f.add(h,i,k,b)}}else b.runTemplate&&b.runTemplate();var l=this;f.submit(function(){l.execute("afterBatchSubmit")})},b.prototype.render=function(a,b,c){var d="string"==typeof a?a:a.html();c===!1&&template.config("escape",!1);var e=Template7.compile(d);return c===!1&&template.config("escape",!0),e(b)},b}),cb.init=function(a,b){if(a){var c=document.createElement("div");c.innerHTML=a;var d=Dom7(c).find(".page");if(d.length){var e="data-controller",f=d.attr(e);f&&cb.loader.processNode(c,function(){var a=cb.views[f];if(a){var c={},e=new a(c);if(b&&b(e,d[0].outerHTML)!==!1){for(var g,h,i,j,k,l,m="id",n="data-name",o="data-type",p="data-config",q=e.getView().find("["+o+"]"),r=0,s=q.length;s>r;r++){g=q[r],h=g.getAttribute(m),i=g.getAttribute(n),j=g.getAttribute(o),k=cb.data.JsonSerializer.deserialize(g.getAttribute(p)),h||(h=i,g.setAttribute(m,h));var t=cb.widgets[j];t&&(l=new t(h,k,e),l._set_data("parent",e),c[i]=l)}e.once&&e.once(),cb.executeController(e)}}})}}},cb.executeController=function(a){a.run(),a.init&&a.init()},cb.rest={},cb.rest.loadImage=function(a,b){function c(){a.attr("src",b)}a=Dom7(a),b=cb.util.adjustImgSrc(b);var d=(new Date).valueOf();b+=b.indexOf("?")<0?"?_="+d:"&_="+d;var e=new Image;e.onload=c,e.onerror=c,e.src=b},cb.rest.ContextBuilder={construct:function(a,b,c){var d=new cb.util.queryString,e=cb.config&&cb.config.webDomain?cb.config.webDomain:location.protocol+"//"+location.host;if(cb.rest.AppContext={serviceUrl:e,size:"M",device:b?"android":c?"ios":""},cb.config)cb.config.webDomain?cb.rest.AppContext.ImageServer=cb.config.webDomain:cb.config.fromWechat&&(cb.rest.AppContext.wid=d.get("wid"),cb.rest.AppContext.oid=cb.data.CookieParser.getCookie("oid"),cb.rest.AppContext.shareparentid=d.get("shareparentid"));else{"true"===d.get("preview")&&(cb.rest.AppContext.preview=!0),d.has("corpalias")&&(cb.rest.AppContext.corpAlias=d.get("corpalias"));var f=d.get("invitecode"),g=d.get("promotcode");f||g?(cb.util.localStorage.removeItem("inviteCode"),cb.util.localStorage.removeItem("promotCode"),f&&(cb.util.localStorage.setItem("inviteCode",f),cb.rest.AppContext.inviteCode=f),g&&(cb.util.localStorage.setItem("promotCode",g),cb.rest.AppContext.promotCode=g)):(f=cb.util.localStorage.getItem("inviteCode"),f&&(cb.rest.AppContext.inviteCode=f),g=cb.util.localStorage.getItem("promotCode"),g&&(cb.rest.AppContext.promotCode=g))}cb.rest.AppContext.token=this.getToken(),a();var h=cb.rest.DynamicProxy.create({getMemberInfoByToken:{url:"member/Members/getMemberByToken",method:"GET",options:{token:!0}}});return void h.getMemberInfoByToken(function(a,b){b&&(cb.util.localStorage.setItem("accountInfo",JSON.stringify(b)),window.logger&&logger(window,document,void 0,cb.rest.AppContext.wid,void 0,cb.rest.AppContext.oid,b.iCorpId,b.id,document.URL))});var h},setToken:function(a){return cb.config&&cb.config.fromWechat?void cb.data.CookieParser.setCookie("token",a):void localStorage.setItem("token",a)},getToken:function(){return cb.config&&cb.config.fromWechat?cb.data.CookieParser.getCookie("token")||"":localStorage.getItem("token")||""},removeToken:function(){return cb.config&&cb.config.fromWechat?void cb.data.CookieParser.delCookie("token"):void localStorage.removeItem("token")}},cb.rest._getUrl=function(a,b){var c=cb.rest.AppContext,d=new cb.util.queryString(a);return d.set("size",c.size),cb.config&&cb.config.fromWechat?(d.set("terminaltype","WeChat"),d.set("wid",c.wid),d.set("oid",c.oid),c.shareparentid&&d.set("shareparentid",c.shareparentid)):d.set("terminaltype","Mobile"),b&&b.refresh&&d.set("_",(new Date).valueOf()),b&&b.token&&d.set("token",c.token),c.preview&&d.set("preview",c.preview),c.corpAlias&&d.set("corpalias",c.corpAlias),a=d.pathname+d.toStr(),a.indexOf("http://")<0&&("/"!==a.substr(0,1)&&(a="/"+a),a=c.serviceUrl+a),a},cb.rest._appendUrl=function(a,b){if(!b)return a;var c=[];for(var d in b)c.push(d+"="+b[d]);if(!c.length)return a;var e=c.join("&");return a.indexOf("?")>=0?a+"&"+e:a+"?"+e},cb.rest.DynamicProxy=function(a){this.init&&this.init(a)},cb.rest.DynamicProxy.create=function(a){return new cb.rest.DynamicProxy(a)},cb.rest.DynamicProxy.prototype.init=function(a){if(a){this.config=a;for(var b in this.config)this[b]=function(a){return function(b,c,d){return this.Do(a,b,c,null,d)}}(b),this[b+"Sync"]=function(a){return function(b){return this.Do(a,b,null,!1)}}(b)}},cb.rest.DynamicProxy.prototype.Do=function(a,b,c,d,e){if(this.config&&this.config[a]&&this.config[a].url){var f=this.config[a],g=f.url,h=cb.util.extend({},f.options);return h.method=f.method||"GET","function"==typeof b?(h.callback=b,h.context=e||h.context||this):h.params=b,c&&(h.callback=c,h.context=e||h.context||this),d===!1&&(h.async=!1),this.ajax(g,h)}},cb.rest.DynamicProxy.prototype.ajax=function(a,b){return cb.rest.ajax(a,b)},cb.rest.MergeProxy=function(){var a={datas:[],events:[]};this.add=function(a,b,c,d){if(cb.util.isArray(a)){var e=a.length;if(cb.util.isArray(b)){if(b.length===e)for(var f=0;e>f;f++)this.addInner(a[f],b[f],c,d)}else for(var f=0;e>f;f++)this.addInner(a[f],b,c,d)}else this.addInner(a,b,c,d)},this.addInner=function(b,c,d,e){var f,g=b.method.toLocaleUpperCase(),h=cb.rest._getUrl(b.url,b.options);"GET"===g||"DELETE"===g?(h=cb.rest._appendUrl(h,c),f=null):f=c,a.datas.push({requestUrl:h,requestMethod:g,requestData:f}),a.events.push({callback:d,context:e})},this.submit=function(b){if(!a.datas.length)return void(b&&b());var c=cb.rest.DynamicProxy.create({BatchSubmit:{url:"client/batchSubmit",method:"POST"}});c.BatchSubmit(a.datas,function(c,d){if(c)return void alert("合并请求提交失败: "+c);var e=d&&d.length;if(e){for(var f=0;e>f;f++){var g=a.events[f];g&&cb.rest.AjaxRequestManager.processAjaxResult(d[f],g.callback,g.context)}b&&b()}})}},cb.rest.MergeProxy.create=function(){return new cb.rest.MergeProxy},cb.rest.ajax=function(a,b){return b.url=a,cb.rest.AjaxRequestManager.doRequest(b)},cb.rest.AjaxRequestManager={_xhrs:[],doRequest:function(a){var b=this.getXMLHttpRequest();if(b){var c=a.method||"GET",d=cb.rest._getUrl(a.url,a),e=null;if(c.equalsIgnoreCase("get")||c.equalsIgnoreCase("delete")?d=cb.rest._appendUrl(d,a.params):(c.equalsIgnoreCase("post")||c.equalsIgnoreCase("put"))&&(e=cb.data.JsonSerializer.serialize(a.params)),b.open(c,d,a.async===!1?!1:!0),b.setRequestHeader("Content-Type","application/json;charset=utf-8"),b.send(e),a.async===!1)return this.onreadystatechange(b,a);b.onreadystatechange=function(){cb.rest.AjaxRequestManager.onreadystatechange(this,a)},a.mask===!0&&cb.util.loadingControl.start()}},onreadystatechange:function(a,b){if(4===a.readyState){if(b.mask===!0&&cb.util.loadingControl.end(),200===a.status){var c=cb.data.JsonSerializer.deserialize(a.responseText);cb.rest.AjaxRequestManager.processAjaxResult(c,b.callback,b.context,b)}a.isBusy=!1}},getXMLHttpRequest:function(){for(var a,b=0,c=this._xhrs.length;c>b;b++)if(!this._xhrs[b].isBusy){a=this._xhrs[b];break}return a||(a=this.createXMLHttpRequest(),this._xhrs.push(a)),a.isBusy=!0,a},createXMLHttpRequest:function(){var a=window.XMLHttpRequest?new XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null;return a},processAjaxResult:function(a,b,c,d){if(a&&a.code)if(200==a.code)b&&b.call(c,null,a.data);else{if(900===a.code&&d&&d.token&&d.autoLogin!==!1)return void cb.route.redirectLoginPage();b&&b.call(c,a)}}},cb.data={},cb.data.JsonSerializer={serialize:function(a){if(!a)return null;if(window.JSON&&JSON.stringify)return JSON.stringify(a);var b=typeof a;return"string"===b||"number"===b||"boolean"===b?a:a.constructor===Array?this._innerSerialize(a):this._innerSerializeObj(a)},_innerSerializeObj:function(a){var b=[];for(var c in a)"function"!=typeof a[c]&&b.push('"'+c+'":'+this._innerSerialize(a[c]));return"{"+b.join(",")+"}"},_innerSerialize:function(a){if(cb.util.isEmpty(a))return null;var b=typeof a;if("number"===b||"boolean"===b)return a;if(a.constructor===Array){var c=[];return a.forEach(function(a){c.push(this._innerSerialize(a))},this),"["+c.join(",")+"]"}return"object"===b?this._innerSerializeObj(a):'"'+a+'"'},deserialize:function(data){return data?window.JSON&&JSON.parse?JSON.parse(data):eval("("+data.replace(/\r\n/g,"")+")"):null}},cb.data.CookieParser={setCookie:function(a,b,c){cb.config&&cb.config.fromWechat&&(a=cb.rest.AppContext.wid+"_"+a),null==c&&(c=30);var d=new Date;d.setTime(d.getTime()+24*c*60*60*1e3),document.cookie=a+"="+escape(b)+";expires="+d.toGMTString()},getCookie:function(a){cb.config&&cb.config.fromWechat&&(a=cb.rest.AppContext.wid+"_"+a);var b,c=new RegExp("(^|)"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null},delCookie:function(a){cb.config&&cb.config.fromWechat&&(a=cb.rest.AppContext.wid+"_"+a);var b=new Date;b.setTime(b.getTime()-1);var c=this.getCookie(a);null!=c&&(document.cookie=a+"="+c+";expires="+b.toGMTString())}},cb.util={html2Escape:function(a){return a.replace(/[<>&"]/g,function(a){return{"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;"}[a]})},isElementInViewport:function(a,b){var c=window.innerWidth,d=window.innerHeight;"number"!=typeof c&&("CSS1Compat"===document.compatMode?(c=document.documentElement.clientWidth,d=document.documentElement.clientHeight):(c=document.body.clientWidth,d=document.body.clientHeight));var e=a.getBoundingClientRect();return e.top>=0-b&&e.left>=0-b&&e.top<=d+b&&e.left<=c+b},adjustImgSrc:function(a){if(!a)return a;var b=a.replace(/\\/g,"/");return cb.rest.AppContext.ImageServer&&b.indexOf("http://")<0&&(b="/"===b.substr(0,1)?cb.rest.AppContext.ImageServer+b:cb.rest.AppContext.ImageServer+"/"+b),b},formatDate:function(a,b){if(!a)return a;b||(b="yyyy-MM-dd"),a=a.split(" ");var c=new Date(a),d={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),S:c.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in d)new RegExp("("+e+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?d[e]:("00"+d[e]).substr((""+d[e]).length)));return b},queryString:function(a){this.pathname="",this.query={},this.init=function(){a||(a=location.search);var b=a.indexOf("?"),c=a.indexOf("#");if(b>=0){if(this.pathname=a.substr(0,b),a=0>c?a.substr(b+1):a.substring(b+1,c),a.length>0){a=a.replace(/\+/g," ");for(var d=a.split("&"),e=0,f=d.length;f>e;e++){var g=d[e].split("="),h=decodeURIComponent(g[0]),i=2==g.length?decodeURIComponent(g[1]):h;this.query[h]=i}}}else this.pathname=a},this.set=function(a,b){this.query[a]=b},this.get=function(a){return this.query[a]},this.has=function(a){return null!=this.query[a]},this.del=function(a){delete this.query[a]},this.toStr=function(){var a=["?"];for(var b in this.query)a.push(encodeURIComponent(b)),a.push("="),a.push(encodeURIComponent(this.query[b])),a.push("&");return 1===a.length?"":(a.removeAt(a.length-1),a.join(""))},this.init()},localStorage:{setItem:function(a,b){return cb.config&&cb.config.fromWechat?void localStorage.setItem(cb.rest.AppContext.wid+"_"+a,b):void localStorage.setItem(a,b)},getItem:function(a){return cb.config&&cb.config.fromWechat?localStorage.getItem(cb.rest.AppContext.wid+"_"+a):localStorage.getItem(a)},removeItem:function(a){return cb.config&&cb.config.fromWechat?void localStorage.removeItem(cb.rest.AppContext.wid+"_"+a):void localStorage.removeItem(a)}},extend:function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||cb.util.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(cb.util.isPlainObject(c)||(b=cb.util.isArray(c)))?(b?(b=!1,f=a&&cb.util.isArray(a)?a:[]):f=a&&cb.util.isPlainObject(a)?a:{},g[d]=cb.util.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},isFunction:function(a){return"function"===cb.util.type(a)},isArray:Array.isArray||function(a){return"array"===cb.util.type(a)},isWindow:function(a){return null!=a&&a==a.window},isPlainObject:function(a){var b;if(!a||"object"!==cb.util.type(a)||a.nodeType||cb.util.isWindow(a))return!1;try{if(a.constructor&&!hasOwn.call(a,"constructor")&&!hasOwn.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(support.ownLast)for(b in a)return hasOwn.call(a,b);for(b in a);return void 0===b||hasOwn.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?class2type[toString.call(a)]||"object":typeof a},each:function(a,b,c){var d,e=0,f=a.length,g=isArraylike(a);if(c){if(g)for(;f>e&&(d=b.apply(a[e],c),d!==!1);e++);else for(e in a)if(d=b.apply(a[e],c),d===!1)break}else if(g)for(;f>e&&(d=b.call(a[e],e,a[e]),d!==!1);e++);else for(e in a)if(d=b.call(a[e],e,a[e]),d===!1)break;return a}};var class2type={};cb.util.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){class2type["[object "+b+"]"]=b.toLowerCase()}),String.prototype.equalsIgnoreCase=function(a){return null==a?!1:this.toLowerCase()===a.toLowerCase()},Array.prototype.removeAt=function(a){return a>=0?this.splice(a,1):void 0},Array.prototype.unique=function(a){a.sort();for(var b=[a[0]],c=1;c<a.length;c++)a[c]!==b[b.length-1]&&b.push(a[c]);return b},cb.util.extend(cb.widgets.BaseWidget.prototype,cb.events),cb.util.extend(cb.views.BaseView.prototype,cb.events),cb.cache={get:function(a){return this[a]},set:function(a,b){this[a]=b},clear:function(){for(var a in this)"get"!=a&&"set"!=a&&"clear"!=a&&delete this[a]}},cb.loader={},cb.loader.init=function(){this.loadedStyles={};for(var a=document.getElementsByTagName("link"),b=0,c=a.length;c>b;b++){var d=a[b].href.trim().toLocaleLowerCase();d&&(this.loadedStyles[d]=!0)}this.loadedScripts={};for(var e=document.getElementsByTagName("script"),b=0,c=e.length;c>b;b++){var f=e[b].src.trim().toLocaleLowerCase();f&&(this.loadedScripts[f]=!0)}},cb.loader.init(),cb.loader.processNode=function(a,b){var c=a.getElementsByTagName("link");if(c.length)for(var d=document.head||document.getElementsByTagName("head")[0],e=0,f=c.length;f>e;e++){var g=c[e].href.trim();g&&!this.loadedStyles[g.toLocaleLowerCase()]&&(d.appendChild(c[e].cloneNode()),this.loadedStyles[g.toLocaleLowerCase()]=!0)}for(var h=a.getElementsByTagName("script"),i=[],e=0,f=h.length;f>e;e++){var j=h[e].src.trim();j&&!this.loadedScripts[j.toLocaleLowerCase()]&&i.push(j)}if(i.length){var k=this;$script(i,function(){i.forEach(function(a){k.loadedScripts[a.toLocaleLowerCase()]=!0}),b()})}else b()};